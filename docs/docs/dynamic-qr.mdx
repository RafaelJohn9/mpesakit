---
title: Dynamic QR Code
description: Generate and manage dynamic QR codes for M-Pesa payments
---

import SectionHeader from '@site/docs/components/SectionHeader';
import CodeBlock from '@site/docs/components/CodeBlock';
import Alert from '@site/docs/components/Alert';
import Tabs from '@site/docs/components/Tabs';
import ParametersTable from '@site/docs/components/ParametersTable';

<Alert type="warning" title="Important">
    Dynamic QR Codes can only be scanned and completed from inside the M-Pesa mobile application. They are not usable from generic QR readers.
</Alert>

<SectionHeader 
    subtitle="Generate and manage dynamic M-Pesa QR codes for payments and transfers. Dynamic QR lets you create a QR payload for a single transaction that includes amount, reference and recipient details."
    gradient={true}
    size="large"
/>

<SectionHeader title="User Stories" size="small" />

- As a fintech product owner, I want to programmatically generate dynamic QR codes so that customers can easily make payments.
- As an integrations developer, I want a simple client and clear webhook callbacks so I can implement reliable end-to-end flows with minimal boilerplate.
- As a billing operations engineer, I want result and timeout notifications with acknowledgements so I can reconcile transactions and trigger retries or alerts when needed.
- As a reseller partner, I want a tested SDK and examples so I can onboard quickly and reduce integration defects.

<SectionHeader title="Parameters" size="small" />

<ParametersTable 
parameters={[
    {
        name: "MerchantName",
        type: "str",
        dataType: "String",
        required: true,
        description: "Merchant or business name shown on the QR experience (e.g., store name)."
    },
    {
        name: "RefNo",
        type: "str",
        dataType: "String",
        required: true,
        description: "Transaction reference or account identifier (e.g., invoice or order id)."
    },
    {
        name: "Amount",
        type: "int",
        dataType: "Integer",
        required: true,
        description: "Amount in KES. Must be greater than zero."
    },
    {
        name: "TrxCode",
        type: "str",
        dataType: "String",
        required: true,
        description: "Transaction type code. Supported values: BG, WA, PB, SM, SB."
    },
    {
        name: "CPI",
        type: "str",
        dataType: "String",
        required: true,
        description: "Credit Party Identifier: mobile number, paybill, till or business identifier depending on TrxCode."
    },
    {
        name: "Size",
        type: "str",
        dataType: "String",
        required: true,
        description: "QR image size in pixels (square). Example: '300'."
    },
]}
/>

<SectionHeader
    title="Integration Overview"
    subtitle="Two integration patterns: use the library-level client (recommended) for quick setup or the lower-level service for custom workflows."
    size="small"
/>

<Tabs defaultValue={0}>
    <Tabs.TabPane label="Library Client" icon="üöÄ">
        <Alert type="info" title="Recommended">
            Use the high-level client to handle authentication and common defaults. It gives a simple surface for generating dynamic QR codes.
        </Alert>

        <SectionHeader title="Quick Start (Python)" size="small" />
        <CodeBlock language="python" title="Python">
{`# Example: using MpesaClient facade to create a dynamic QR
from mpesakit import MpesaClient
from mpesakit.dynamic_qr_code import DynamicQRTransactionType

client = MpesaClient(
        consumer_key="YOUR_KEY",
        consumer_secret="YOUR_SECRET",
        environment="sandbox",
)

response = client.dynamic_qr.generate(
        merchant_name="Corner Store",
        ref_no="ORDER-1001",
        amount=250,
        trx_code=DynamicQRTransactionType.BUY_GOODS,
        cpi="373132",
        size="300",
)

if response.is_successful():
        print("QR generated", response.QRCode)
else:
        print("Failed:", response.ResponseDescription)`}
        </CodeBlock>

        <Alert type="info" title="Notes">
            - Provide either numeric/traditional values for TrxCode (use the transaction type enum) and ensure CPI matches the TrxCode semantics (mobile vs business).
            - Amount must be > 0.
        </Alert>
    </Tabs.TabPane>

    <Tabs.TabPane label="Direct Service" icon="‚ö°">
        <Alert type="warning" title="Advanced">
            Use the direct service when you need explicit control over requests, middleware, or custom HTTP behavior.
        </Alert>

        <SectionHeader title="Direct Service Usage" size="small" />
        <CodeBlock language="python" title="Python">
{`# Example: using the DynamicQRCode service directly
from mpesakit.dynamic_qr_code import DynamicQRCode, DynamicQRGenerateRequest, DynamicQRTransactionType
from mpesakit.auth import TokenManager
from mpesakit.http_client.mpesa_http_client import MpesaHttpClient
import os

http_client = MpesaHttpClient(env="sandbox")
token_mgr = TokenManager(
        consumer_key=os.getenv("MPESA_CONSUMER_KEY"),
        consumer_secret=os.getenv("MPESA_CONSUMER_SECRET"),
        http_client=http_client,
)

service = DynamicQRCode(http_client=http_client, token_manager=token_mgr)

req = DynamicQRGenerateRequest(
        MerchantName="Corner Store",
        RefNo="ORD-200",
        Amount=150,
        TrxCode=DynamicQRTransactionType.BUY_GOODS,
        CPI="373132",
        Size="300",
)

resp = service.generate(req)

if resp.is_successful():
        # resp.QRCode contains the QR payload (e.g., base64 or image data)
        print("QR ready:", resp.QRCode)
else:
        print("Error:", resp.ResponseDescription)`}
        </CodeBlock>

        <Alert type="info" title="CPI Normalization">
            When TrxCode is for sending to a mobile (SEND_MONEY), the service normalizes common Kenyan number formats (0..., +254..., 254...) to the canonical 254... format. Invalid numbers will raise a validation error.
        </Alert>
    </Tabs.TabPane>
</Tabs>

<SectionHeader title="Response" size="small" />

- Response objects are typed models with attributes matching the API response fields.
- Use `is_successful()` to check if the request succeeded.
- If you need the raw response data, use `model_dump(mode="json")` to get a dictionary representation.

<CodeBlock language="json" title="Sample Response">
{`{
    "ResponseCode": "00",
    "ResponseDescription": "QR Code generated successfully",
    "QRCode": "iVBORw0KGgoAAAANSUhEUgAA..."
}`}
</CodeBlock>

<CodeBlock language="python" title="Python">
{`# Check success and extract QR payload
if response.is_successful():
        payload = response.QRCode
        # store or render payload as needed
else:
        print("Failed to generate QR:", response.ResponseDescription)`}
</CodeBlock>

<Alert type="info" title="Error handling">
    - Validation errors (invalid TrxCode, bad CPI for SEND_MONEY, etc.) raise exceptions at request model creation time.  
    - HTTP or API-level errors should be caught and inspected (use the library exceptions to get code, message and HTTP status).
</Alert>

<SectionHeader title="Next Steps" size="small" />
<Alert type="info" title="What's next?">
    - Implement a flow to render or serve the QR image to customers after generation.  
    - Monitor flow completion via M-Pesa app actions and reconcile transactions using your normal payment notifications and webhooks.
</Alert>

## Related

- [üì° Webhook Setup Guide](/webhooks-best-practices)
- [üèóÔ∏è Production Checklist](/production)